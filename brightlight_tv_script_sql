select * from Bright_tv;

select UserID
FROM VEIWERSHIP;
--Joining 2 tables--
SELECT B.USERID, NAME, SURNAME, EMAIL, GENDER,RACE,AGE,PROVINCE,SOCIAL_MEDIA_HANDLE, CHANNEL2, RECORDDATE2,DURATION2
FROM BRIGHT_TV B
FULL OUTER JOIN VEIWERSHIP AS A
ON
B.USERID=A.USERID;

SELECT* FROM BRIGHT_TV;

create table brightlight_tv AS(SELECT B.USERID,NAME,SURNAME, EMAIL,GENDER,RACE,AGE,PROVINCE,SOCIAL_MEDIA_HANDLE, CHANNEL2, RECORDDATE2,DURATION2
FROM BRIGHT_TV B
FULL OUTER JOIN VEIWERSHIP AS A
ON
B.USERID=A.USERID
);
SELECT* FROM BRIGHTLIGHT_TV;

alter table BRIGHTLIGHT_TV add record_time time;
alter table brightlight_tv add record_date date;
alter table brightlight_tv add record_date_date varchar;
alter table brightlight_tv add record_date_time varchar;
alter table brightlight_tv add record_date_date varchar;
update brightlight_tv set record_date_date=left(recorddate2 ,10);
update brightlight_tv set record_date = cast(record_date AS DATE);

update brightlight_tv set record_time=right(recorddate2,5);
UPDATE brightlight_tv set record_time=cast(record_date_time AS time);
SET record_time = CAST(recorddate_time AS TIME);
SET record_time = CAST(recorddate_time AS TIME);
alter table brightlight_tv drop record_date_date,record_date_time,recorddate2;

SELECT * FROM BRIGHTLIGHT_TV;

SELECT *,
CASE
    WHEN RECORD_TIME BETWEEN '00:00:01' AND '04:00:00' THEN '12AM-4AM'
    WHEN RECORD_TIME BETWEEN '04:00:01' AND '08:00:00' THEN '4AM-8AM'
    WHEN RECORD_TIME BETWEEN '08:00:01' AND '12:00:00' THEN '8AM-12AM'
    WHEN RECORD_TIME BETWEEN '12:00:01' AND '16:00:00' THEN '12PM-16PM'
    WHEN RECORD_TIME BETWEEN '16:00:01' AND '20:00:00' THEN '16PM-20PM'
    ELSE'20PM-OOAM'
    END AS TIME_BUCKET,
     
     CASE
        WHEN AGE BETWEEN 0 AND 12 THEN'CHILD'
        WHEN AGE BETWEEN 13 AND 19 THEN'TEEN'
        WHEN AGE BETWEEN 20 AND 24 THEN'Young Adult'
        WHEN AGE BETWEEN 25 AND 35 THEN'Emerging Adult'
        WHEN AGE BETWEEN 35 AND 49 THEN'Adult'
        WHEN AGE BETWEEN 50 AND 59 THEN'Advanced middle Age'
END as AGE_GROUP,


CASE
  WHEN RECORD_DATE BETWEEN '2016-01-01' AND '2016-01-31' THEN 'JAN'
  WHEN RECORD_DATE BETWEEN '2016-02-01' AND '2016-02-29' THEN 'FEB'
  WHEN RECORD_DATE BETWEEN '2016-03-01' AND '2016-03-31' THEN 'MAR'
  ELSE 'APR'
END AS MONTH_

FROM BRIGHTLIGHT_TV;

CREATE TABLE BRIGHTLITE_TV AS (SELECT*,CASE WHEN RECORD_TIME BETWEEN '00:00:01' AND '04:00:00' THEN '12AM-4AM'
    WHEN RECORD_TIME BETWEEN '04:00:01' AND '08:00:00' THEN '4AM-8AM'
    WHEN RECORD_TIME BETWEEN '08:00:01' AND '12:00:00' THEN '8AM-12AM'
    WHEN RECORD_TIME BETWEEN '12:00:01' AND '16:00:00' THEN '12PM-16PM'
    WHEN RECORD_TIME BETWEEN '16:00:01' AND '20:00:00' THEN '16PM-20PM'
    ELSE'20PM-OOAM'
    END AS TIME_BUCKET,
     
     CASE
        WHEN AGE BETWEEN 0 AND 12 THEN'CHILD'
        WHEN AGE BETWEEN 13 AND 19 THEN'TEEN'
        WHEN AGE BETWEEN 20 AND 24 THEN'Young Adult'
        WHEN AGE BETWEEN 25 AND 35 THEN'Emerging Adult'
        WHEN AGE BETWEEN 35 AND 49 THEN'Adult'
        WHEN AGE BETWEEN 50 AND 59 THEN'Advanced middle Age'
END as AGE_GROUP,


CASE
  WHEN RECORD_DATE BETWEEN '2016-01-01' AND '2016-01-31' THEN 'JAN'
  WHEN RECORD_DATE BETWEEN '2016-02-01' AND '2016-02-29' THEN 'FEB'
  WHEN RECORD_DATE BETWEEN '2016-03-01' AND '2016-03-31' THEN 'MAR'
  ELSE 'APR'
END AS MONTH_

FROM BRIGHTLIGHT_TV);

--NUMBER OF USERES PER CHANNEL--
SELECT COUNT(USERID)NUMBER_OF_VIEWERS,province,
FROM BRIGHTLITE_TV
WHERE DURATION2 >'00:00:00'
GROUP BY province
ORDER BY NUMBER_OF_VIEWERS DESC;

--TIME WHEN MOST PEOPLE ARE WATCHING TV--
SELECT COUNT(DISTINCT USERID), TIME_BUCKET
FROM BRIGHTLITE_TV
WHERE DURATION2>'00:00:00'
GROUP BY TIME_BUCKET
ORDER BY COUNT(USERID)DESC;

--Province with most viewers--
SELECT COUNT (DISTINCT USERID), PROVINCE
FROM BRIGHTLITE_TV
GROUP BY PROVINCE
ORDER BY COUNT(USERID)DESC;

--VIEWERSHIP BY THE RACE PER PROVINCE--
SELECT RACE,COUNT(DISTINCT USERID)AS NUMBER_OR_VIEWERS, PROVINCE
FROM BRIGHTLITE_TV
GROUP BY RACE, PROVINCE;

--vieweship per day--
SELECT record_date, COUNT(USERID)AS viewers_per_day,
FROM BRIGHTLITE_TV
GROUP BY RECORD_DATE
ORDER BY COUNT(USERID)DESC
LIMIT 5;

SELECT AGE
CASE,
        WHEN AGE BETWEEN 0 AND 12 THEN'CHILD'
        WHEN AGE BETWEEN 13 AND 19 THEN'TEEN'
        WHEN AGE BETWEEN 20 AND 24 THEN'Young Adult'
        WHEN AGE BETWEEN 25 AND 35 THEN'Emerging Adult'
        WHEN AGE BETWEEN 35 AND 49 THEN'Adult'
        WHEN AGE BETWEEN 50 AND 59 THEN'Advanced middle Age'
END as AGE_GROUP,

FROM BRIGHTLITE_TV;


SELECT*FROM BRIGHTLITE_TV;
-- Top 10 viewed channels--
SELECT channel2, COUNT(*) as views
FROM BRIGHTLITE_TV
GROUP BY channel2
ORDER BY views DESC
LIMIT 10;

SELECT 
    RACE,
    DURATION2 AS VIEWING_TIME
FROM 
    BRIGHTLITE_TV
ORDER BY 
    RACE, VIEWING_TIME DESC;


    SELECT* FROM BRIGHTLITE_TV;

    SELECT DISTINCT(RACE), CHANNEL2, DURATION2
    FROM BRIGHTLITE_TV
    GROUP BY ALL;

    SELECT 
    RACE,
    DURATION2 AS VIEWING_TIME
FROM 
    BRIGHTLITE_TV
ORDER BY 
    RACE, VIEWING_TIME DESC;
SELECT 
    RACE,
    COUNT(*) AS TOTAL_VIEWS,
    AVG(DURATION2) AS AVG_VIEW_TIME,
    MIN(DURATION2) AS MIN_VIEW_TIME,
    MAX(DURATION2) AS MAX_VIEW_TIME,
    SUM(DURATION2) AS TOTAL_VIEW_MINUTES
FROM 
    BRIGHTLITE_TV
GROUP BY 
    RACE
ORDER BY 
    TOTAL_VIEW_MINUTES DESC;


SELECT RACE, AVG(DURATION2),
FROM BRIGHTLITE_TV
GROUP BY RACE
ORDER BY DURATION2 DESC;

-- by race by time--

SELECT RACE, AVG(DURATION2) AS AVG_DURATION
FROM BRIGHTLITE_TV
GROUP BY RACE
ORDER BY AVG_DURATION2 DESC;

